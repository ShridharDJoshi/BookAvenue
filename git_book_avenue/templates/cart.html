{% extends 'base.html' %}

{% block content %}

<div class="fade-in-up" style="max-width: 1100px; margin: 40px auto;">
    
    <h1 style="margin-bottom: 30px; font-weight: 700; color: var(--text-main);">Your Shopping Cart</h1>

    {% if cart_items %}
    <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 40px; align-items: start;">
        
        <div class="cart-list" style="display: flex; flex-direction: column; gap: 20px;">
            {% for item in cart_items %}
            <div style="background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: var(--shadow); display: flex; align-items: center; gap: 20px; border: 1px solid var(--border-color); transition: 0.3s;">
                
                <div style="width: 80px; height: 110px; flex-shrink: 0; overflow: hidden; border-radius: 8px; background: #eee;">
                    {% if item.book.image %}
                        <img src="{{ item.book.image.url }}" alt="{{ item.book.title }}" style="width: 100%; height: 100%; object-fit: cover;">
                    {% else %}
                        <div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #aaa; font-size: 0.7rem;">No Image</div>
                    {% endif %}
                </div>

                <div style="flex-grow: 1;">
                    <h3 style="font-size: 1.2rem; margin-bottom: 5px; color: var(--text-main);">
                        <a href="{% url 'book_detail' item.book.id %}">{{ item.book.title }}</a>
                    </h3>
                    <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 8px;">by {{ item.book.author }}</p>
                    
                    <div style="font-size: 1rem; color: var(--text-main);">
                        <span style="font-weight: 600;">â‚¹{{ item.book.price }}</span> 
                        <span style="color: var(--text-muted); font-size: 0.85rem;"> x {{ item.quantity }}</span>
                    </div>
                </div>

                <div style="text-align: right; min-width: 100px;">
                    <div style="margin-bottom: 10px; color: var(--primary); font-weight: 700; font-size: 1.1rem;">
                         â‚¹{% widthratio item.book.price 1 item.quantity %}
                    </div>
                    
                    <a href="{% url 'remove_from_cart' item.book.id %}" 
                       style="color: #c62828; font-size: 0.85rem; text-decoration: underline; font-weight: 600;">
                       Remove
                    </a>
                </div>

            </div>
            {% endfor %}
        </div>

        <div class="order-summary" style="background: var(--card-bg); padding: 30px; border-radius: 12px; box-shadow: var(--shadow); border: 1px solid var(--border-color); position: sticky; top: 100px;">
            <h3 style="margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; color: var(--text-main);">Order Summary</h3>
            
            <div style="display: flex; justify-content: space-between; margin-bottom: 15px; color: var(--text-muted);">
                <span>Subtotal ({{ cart_items|length }} items)</span>
                <span>â‚¹{{ total_price }}</span>
            </div>
            
            <div style="display: flex; justify-content: space-between; margin-bottom: 25px; font-weight: 700; font-size: 1.2rem; color: var(--text-main);">
                <span>Total</span>
                <span style="color: var(--primary);">â‚¹{{ total_price }}</span>
            </div>

            <a href="{% url 'checkout' %}" class="btn" style="width: 100%; text-align: center; margin-bottom: 15px; padding: 15px;">
                Proceed to Checkout
            </a>
            
            <a href="{% url 'home' %}" style="display: block; text-align: center; color: var(--text-muted); font-size: 0.9rem;">
                &larr; Continue Shopping
            </a>
        </div>

    </div>

    {% else %}
    
    <div style="text-align: center; padding: 80px 20px; background: var(--card-bg); border-radius: 12px; box-shadow: var(--shadow); border: 1px solid var(--border-color);">
        <div style="font-size: 4rem; margin-bottom: 20px;">ðŸ›’</div>
        <h2 style="color: var(--text-main); margin-bottom: 10px;">Your cart is empty</h2>
        <p style="color: var(--text-muted); margin-bottom: 30px;">Looks like you haven't added any books yet.</p>
        <a href="{% url 'home' %}" class="btn" style="padding: 12px 30px;">Start Shopping</a>
    </div>

    {% endif %}

</div>

<style>
    @media (max-width: 768px) {
        div[style*="grid-template-columns"] {
            grid-template-columns: 1fr !important; 
        }
        .cart-list > div {
            flex-direction: row; 
            padding: 15px;
        }
    }
</style>

{% endblock %}