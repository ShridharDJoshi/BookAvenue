{% extends 'base.html' %}

{% block content %}

<section class="hero" style="text-align: center; padding: 30px 20px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); color: white; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 5px 15px rgba(44, 95, 45, 0.15);">
    <div style="max-width: 800px; margin: 0 auto; display: flex; align-items: center; justify-content: center; flex-direction: column;">
        <h1 style="font-size: 2.2rem; margin-bottom: 5px; font-weight: 700; color: white !important;">Welcome to Books Avenue.</h1>
        <p style="font-size: 1rem; opacity: 0.9; margin-bottom: 20px; color: white !important;">Discover your next favourite book today.</p>
        
        <form action="{% url 'home' %}" method="get" style="width: 100%; max-width: 500px; display: flex; gap: 10px;">
            <input type="text" name="q" placeholder="Search for books..." style="padding: 10px 20px; border-radius: 50px; border: none; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 100%;">
            <button type="submit" class="btn" style="background: var(--accent); color: #000; box-shadow: none; padding: 10px 25px;">Search</button>
        </form>
    </div>
</section>

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
    
    <div style="background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); padding: 20px; border-radius: 12px; color: white; position: relative; overflow: hidden; box-shadow: var(--shadow); display: flex; align-items: center;">
        <div style="position: relative; z-index: 2; flex: 1;">
            <span style="background: var(--accent); color: #333; padding: 3px 8px; border-radius: 15px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase;">Limited Time</span>
            <h3 style="font-size: 1.4rem; margin: 8px 0 5px; line-height: 1.2; color: white !important;">50% OFF<br>Classic Fiction</h3>
            <a href="#" onclick="scrollToBooks(event)" style="font-size: 0.9rem; color: var(--accent); font-weight: bold; text-decoration: none;">Shop Sale &rarr;</a>
        </div>
        <div style="position: absolute; right: -10px; bottom: -10px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%;"></div>
    </div>

    <div style="background: linear-gradient(135deg, #FFC107 0%, #FF9800 100%); padding: 20px; border-radius: 12px; color: #333; position: relative; overflow: hidden; box-shadow: var(--shadow); display: flex; align-items: center;">
        <div style="position: relative; z-index: 2; flex: 1;">
            <span style="background: white; color: #333; padding: 3px 8px; border-radius: 15px; font-size: 0.7rem; font-weight: bold; text-transform: uppercase;">Students</span>
            <h3 style="font-size: 1.4rem; margin: 8px 0 5px; line-height: 1.2; color: #333 !important;">Extra 10%<br>Discount</h3>
            <a href="{% url 'student_offer' %}" style="display: inline-block; background: #333; color: white; padding: 5px 15px; border-radius: 20px; font-size: 0.8rem; font-weight: bold; border: none; cursor: pointer; margin-top: 5px; text-decoration: none;">Get Code</a>
        </div>
        <div style="position: absolute; right: -10px; top: -10px; width: 80px; height: 80px; background: rgba(255,255,255,0.3); border-radius: 50%;"></div>
    </div>

    <div style="background: var(--card-bg); border: 1px solid var(--border-color); padding: 20px; border-radius: 12px; color: var(--text-main); position: relative; overflow: hidden; display: flex; align-items: center;">
        <div style="position: relative; z-index: 2; flex: 1;">
            <h3 style="font-size: 1.3rem; margin-bottom: 5px;">ðŸ“š New Arrivals</h3>
            <p style="color: var(--text-muted); font-size: 0.9rem; margin-bottom: 10px; line-height: 1.3;">We added 50+ new titles this week.</p>
            <a href="#" onclick="scrollToBooks(event)" style="color: var(--primary); font-weight: bold; font-size: 0.9rem;">Check them out &rarr;</a>
        </div>
    </div>
</div>

{% if recommended_books %}
<div class="fade-in-up" style="margin-bottom: 50px; background: #fff3e0; padding: 30px; border-radius: 15px; border: 1px solid #ffe0b2;">
    <h2 style="color: #e65100; margin-bottom: 5px; font-weight: 700;">âœ¨ Recommended For You</h2>
    <p style="color: #ef6c00; margin-bottom: 20px;">Based on your recent reading history.</p>
    
    <div class="book-grid">
        {% for book in recommended_books %}
        <div class="book-card" style="background: white;"> <div style="position: relative; overflow: hidden;">
                <a href="{% url 'book_detail' book.pk %}">
                    {% if book.image %}
                        <img src="{{ book.image.url }}" alt="{{ book.title }}">
                    {% else %}
                        <div style="height: 320px; background: var(--bg-color); display: flex; align-items: center; justify-content: center; color: var(--text-muted);">No Image</div>
                    {% endif %}
                </a>
                
                {% if book.is_bestseller %}
                    <span style="position: absolute; top: 10px; left: 10px; background: var(--accent); color: black; padding: 5px 12px; font-size: 0.8rem; font-weight: bold; border-radius: 20px;">Bestseller</span>
                {% endif %}
                {% if book.is_new %}
                    <span style="position: absolute; top: 10px; right: 10px; background: #d32f2f; color: white; padding: 5px 12px; font-size: 0.8rem; font-weight: bold; border-radius: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">NEW RELEASE</span>
                {% endif %}
            </div>

            <div class="card-body">
                <div>
                    <h3>{{ book.title }}</h3>
                    <p style="color: var(--text-muted); font-size: 0.9rem;">by {{ book.author }}</p>
                </div>
                
                <div style="margin-top: auto; display: flex; justify-content: space-between; align-items: center;">
                    <span class="price">â‚¹{{ book.price }}</span>
                    <a href="{% url 'book_detail' book.pk %}" class="btn" style="padding: 8px 20px; font-size: 0.9rem;">View</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}


<div id="books-target" style="margin-bottom: 30px; text-align: center;">
    <h3 style="margin-bottom: 15px; color: var(--text-muted); font-weight: 500; font-size: 1.1rem;">Browse by Category</h3>
    <div style="display: flex; justify-content: center; gap: 8px; flex-wrap: wrap;">
        <a href="{% url 'home' %}" class="btn-outline" style="border-radius: 50px; text-decoration: none; padding: 6px 20px; font-size: 0.9rem; {% if not request.GET.category %}background: var(--primary); color: white;{% endif %}">All</a>
        
        {% for cat in categories %}
            <a href="{% url 'home' %}?category={{ cat.slug }}" 
               class="btn-outline" 
               style="border-radius: 50px; text-decoration: none; padding: 6px 20px; font-size: 0.9rem; border: 1px solid var(--primary); color: var(--primary); transition: 0.3s; {% if request.GET.category == cat.slug %}background: var(--primary); color: white;{% endif %}">
               {{ cat.name }}
            </a>
        {% endfor %}
    </div>
</div>

<div class="book-grid animate-enter">
    {% for book in books %}
    <div class="book-card">
        <div style="position: relative; overflow: hidden;">
            <a href="{% url 'book_detail' book.pk %}">
                {% if book.image %}
                    <img src="{{ book.image.url }}" alt="{{ book.title }}">
                {% else %}
                    <div style="height: 320px; background: var(--bg-color); display: flex; align-items: center; justify-content: center; color: var(--text-muted);">No Image</div>
                {% endif %}
            </a>
            
            {% if book.is_bestseller %}
                <span style="position: absolute; top: 10px; left: 10px; background: var(--accent); color: black; padding: 5px 12px; font-size: 0.8rem; font-weight: bold; border-radius: 20px;">Bestseller</span>
            {% endif %}

            {% if book.is_new %}
                <span style="position: absolute; top: 10px; right: 10px; background: #d32f2f; color: white; padding: 5px 12px; font-size: 0.8rem; font-weight: bold; border-radius: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">NEW RELEASE</span>
            {% endif %}
        </div>

        <div class="card-body">
            <div>
                <h3>{{ book.title }}</h3>
                <p style="color: var(--text-muted); font-size: 0.9rem;">by {{ book.author }}</p>
            </div>
            
            <div style="margin-top: auto; display: flex; justify-content: space-between; align-items: center;">
                <span class="price">â‚¹{{ book.price }}</span>
                <a href="{% url 'book_detail' book.pk %}" class="btn" style="padding: 8px 20px; font-size: 0.9rem;">View</a>
            </div>
        </div>
    </div>
    {% empty %}
        <div style="text-align: center; grid-column: 1 / -1; padding: 50px;">
            <h3 style="color: var(--text-muted);">No books found in this category.</h3>
            <a href="{% url 'home' %}" class="btn" style="margin-top: 10px;">View All Books</a>
        </div>
    {% endfor %}
</div>

<script>
    // 1. Function for Banner Clicks (Smooth Scroll)
    function scrollToBooks(e) {
        e.preventDefault(); // Prevent standard jump
        const section = document.getElementById('books-target');
        if (section) {
            const rect = section.getBoundingClientRect();
            const offsetPosition = rect.top + window.scrollY - 110;
            
            window.scrollTo({
                top: offsetPosition,
                behavior: 'smooth' 
            });
        }
    }

    // 2. Logic for Page Loads (URL Params)
    document.addEventListener("DOMContentLoaded", function() {
        const urlParams = new URLSearchParams(window.location.search);
        const section = document.getElementById('books-target');
        
        if (section) {
            // SCENARIO A: CATEGORY CLICK (Instant Teleport to prevent flash)
            if (urlParams.has('category')) {
                document.body.style.opacity = '0'; // Hide body briefly
                
                const rect = section.getBoundingClientRect();
                const offsetPosition = rect.top + window.scrollY - 110;

                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'auto' 
                });

                setTimeout(() => {
                    document.body.style.opacity = '1'; // Reveal
                }, 50);
            } 
            // SCENARIO B: SEARCH QUERY (Smooth Scroll)
            else if (urlParams.has('q')) {
                const rect = section.getBoundingClientRect();
                const offsetPosition = rect.top + window.scrollY - 110;

                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth' 
                });
            }
        }
    });
</script>

{% endblock %}